<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elasticsearch Data Manager</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç Elasticsearch Data Manager</h1>
            <p class="subtitle">MS MARCO Dataset Loader</p>
        </header>

        <section class="settings-section">
            <h2>‚öôÔ∏è Settings</h2>
            <div class="settings-card">
                <div class="form-group">
                    <label for="api-url">DataLoader API URL (CPU):</label>
                    <div class="input-with-button">
                        <input type="text" id="api-url" placeholder="http://192.168.86.28:8000">
                        <button class="btn btn-primary" onclick="updateApiUrl()">Save</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="api-url-gpu">DataLoader API URL (GPU):</label>
                    <div class="input-with-button">
                        <input type="text" id="api-url-gpu" placeholder="http://192.168.86.28:8001">
                        <button class="btn btn-primary" onclick="updateApiUrlGpu()">Save</button>
                    </div>
                </div>
            </div>
        </section>

        <section class="status-section">
            <h2>System Status</h2>
            <div class="status-cards">
                <div class="status-card" id="es-status">
                    <div class="status-icon">üìä</div>
                    <div class="status-info">
                        <h3>Elasticsearch</h3>
                        <span class="status-badge checking">Checking...</span>
                    </div>
                </div>
                <div class="status-card" id="loader-status">
                    <div class="status-icon">‚öôÔ∏è</div>
                    <div class="status-info">
                        <h3>Data Loader (CPU)</h3>
                        <span class="status-badge checking">Checking...</span>
                    </div>
                </div>
                <div class="status-card" id="loader-status-gpu">
                    <div class="status-icon">üéÆ</div>
                    <div class="status-info">
                        <h3>Data Loader (GPU)</h3>
                        <span class="status-badge checking">Checking...</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="indices-section">
            <h2>Indices</h2>
            <div class="indices-list" id="indices-list">
                <p class="loading">Loading indices...</p>
            </div>
            <button class="btn btn-refresh" onclick="loadIndices()">üîÑ Refresh</button>
        </section>

        <section class="actions-section">
            <h2>Data Operations</h2>
            
            <div class="action-card">
                <h3>üì• Load Dataset</h3>
                <p>Download and index a dataset from Hugging Face into Elasticsearch.</p>
                
                <div class="form-group">
                    <label for="dataset-select">Dataset:</label>
                    <select id="dataset-select" onchange="onDatasetChange()">
                        <option value="msmarco">MS MARCO (Q&A passages)</option>
                        <option value="esci">Amazon ESCI (Product Catalog Only)</option>
                        <option value="product-search">Product Search Corpus (E-commerce)</option>
                        <option value="open-food-facts">Open Food Facts (Food Products)</option>
                        <option value="amazon-best-sellers">Amazon Best Sellers (From GitHub)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="embedding-model">Embedding Model:</label>
                    <select id="embedding-model">
                        <option value="all-MiniLM-L6-v2">all-MiniLM-L6-v2 (384 dims, fast)</option>
                        <option value="BAAI/bge-large-en-v1.5">bge-large-en-v1.5 (1024 dims)</option>
                        <option value="hkunlp/instructor-xl">instructor-xl (768 dims)</option>
                        <option value="intfloat/multilingual-e5-large">multilingual-e5-large (1024 dims)</option>
                        <option value="intfloat/e5-mistral-7b-instruct">e5-mistral-7b (4096 dims, large)</option>
                    </select>
                </div>
                
                <div class="form-group" id="locale-group" style="display: none;">
                    <label for="locale-select">Locale:</label>
                    <select id="locale-select">
                        <option value="us">US (English)</option>
                        <option value="es">ES (Spanish)</option>
                        <option value="jp">JP (Japanese)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="index-name">Index Name:</label>
                    <input type="text" id="index-name" value="msmarco" placeholder="msmarco">
                </div>
                
                <div class="form-group">
                    <label for="max-docs">Max Documents (0 = all):</label>
                    <input type="number" id="max-docs" value="1000" min="0" placeholder="Leave empty for all">
                </div>
                
                <div class="form-row chunk-options">
                    <div class="form-group">
                        <label for="chunk-size">Chunk Size:</label>
                        <input type="number" id="chunk-size" value="512" min="100" max="2000">
                    </div>
                    
                    <div class="form-group">
                        <label for="chunk-overlap">Chunk Overlap:</label>
                        <input type="number" id="chunk-overlap" value="50" min="0" max="200">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="batch-size">Index Batch Size:</label>
                        <input type="number" id="batch-size" value="500" min="100" max="5000">
                    </div>
                    
                    <div class="form-group">
                        <label for="embedding-batch">Embedding Batch:</label>
                        <input type="number" id="embedding-batch" value="32" min="8" max="128">
                    </div>
                </div>
                
                <button class="btn btn-primary" id="load-btn" onclick="loadData()">
                    üì• Start Loading (CPU)
                </button>
                
                <button class="btn btn-gpu" id="load-btn-gpu" onclick="loadDataGpu()">
                    üéÆ Start Loading (GPU)
                </button>
                
                <button class="btn btn-secondary" id="preload-btn" onclick="preloadModel()">
                    üß† Pre-load Model (CPU)
                </button>
                
                <button class="btn btn-secondary" id="preload-btn-gpu" onclick="preloadModelGpu()">
                    üéÆ Pre-load Model (GPU)
                </button>
                
                <div class="progress-container" id="progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-info">
                        <div class="progress-text" id="progress-text">Initializing...</div>
                        <div class="progress-timer" id="progress-timer">‚è±Ô∏è 0:00</div>
                    </div>
                </div>
            </div>

            <div class="action-card danger">
                <h3>üóëÔ∏è Clear Data</h3>
                <p>Delete indices from Elasticsearch. This action cannot be undone!</p>
                
                <div class="form-group">
                    <label for="delete-index">Index to Delete:</label>
                    <select id="delete-index">
                        <option value="__all__">All Indices</option>
                    </select>
                </div>
                
                <button class="btn btn-danger" onclick="clearData()">
                    üóëÔ∏è Delete Data
                </button>
            </div>
        </section>

        <section class="search-section">
            <h2>üîé Search</h2>
            <div class="search-box">
                <input type="text" id="search-query" placeholder="Enter search query...">
                <select id="search-index">
                    <option value="msmarco">msmarco</option>
                </select>
                <select id="search-type">
                    <option value="vector">üß† Vector (Semantic)</option>
                    <option value="hybrid">üîÄ Hybrid</option>
                    <option value="text">üìù Text (BM25)</option>
                </select>
                <select id="search-embedding-model">
                    <option value="all-MiniLM-L6-v2">all-MiniLM-L6-v2</option>
                    <option value="BAAI/bge-large-en-v1.5">bge-large-en-v1.5</option>
                    <option value="hkunlp/instructor-xl">instructor-xl</option>
                    <option value="intfloat/multilingual-e5-large">multilingual-e5-large</option>
                    <option value="intfloat/e5-mistral-7b-instruct">e5-mistral-7b</option>
                </select>
                <button class="btn btn-primary" onclick="searchData()">Search</button>
            </div>
            <div class="search-results" id="search-results"></div>
        </section>

        <div class="toast-container" id="toast-container"></div>
    </div>

    <script src="app.js"></script>
</body>
</html>
